<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ¿æ™šæ•°å­—èµ„äº§ç®¡ç†å¹³å°</title>
    <style>
        body { font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; background: #f8f9fa; color: #2d3748; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #edf2f7; }
        h1, h2, h3 { color: #2b6cb0; margin-top: 0; }
        input, select { width: 100%; padding: 10px; margin: 5px 0 15px; border: 1px solid #cbd5e0; border-radius: 6px; box-sizing: border-box; }
        .row { display: flex; gap: 15px; align-items:flex-start; }
        .col { flex: 1; }
        button { background: #3182ce; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; width: 100%; transition: 0.2s; }
        button:hover { opacity: 0.9; }
        button:disabled { background: #cbd5e0; cursor: not-allowed; }
        .btn-green { background: #48bb78; }
        .btn-red { background: #f56565; }
        .btn-orange { background: #ed8936; }
        .hidden { display: none !important; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; background: #ebf8ff; color: #2b6cb0; }
        
        .log-box { background: #1a202c; color: #68d391; font-family: monospace; padding: 15px; border-radius: 8px; font-size: 12px; max-height: 200px; overflow-y: auto; }
        .status-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 10px; }
        .status-table th { text-align: left; border-bottom: 2px solid #e2e8f0; padding: 8px; color: #718096; }
        .status-table td { border-bottom: 1px solid #edf2f7; padding: 8px; }
        
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .modal-box { background: white; width: 400px; padding: 30px; border-radius: 12px; text-align: center; }
        .progress-bar { height: 4px; background: #edf2f7; width: 100%; margin: 20px 0; border-radius: 2px; }
        .progress-fill { height: 100%; background: #48bb78; width: 0%; transition: width 0.5s; }
    </style>
</head>
<body>

<div class="container">
    <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
        <div>
            <h1>é…’åº—æˆ¿æ™šæ•°å­—èµ„äº§ç®¡ç†å¹³å° <span style="font-size:14px; color:#718096;">(v3.2 Pilot)</span></h1>
            <div style="font-size:13px; color:#718096;">B2B æ•°å­—åŒ–åˆ†é”€ä¸æ‰˜ç®¡è§£å†³æ–¹æ¡ˆ</div>
        </div>
        <div style="text-align:right;">
            <div id="userInfo" class="hidden">
                <div id="userEmail" style="font-weight:bold;"></div>
                <div id="userRole" class="badge"></div>
                <div style="font-size:11px; font-family:monospace; margin-top:5px;" id="userAddr"></div>
                <button onclick="logout()" class="btn-red" style="width:auto; padding:4px 10px; font-size:12px; margin-top:5px;">é€€å‡º</button>
            </div>
            <select id="langSwitcher" style="width:auto; margin:0;" onchange="updateLang()">
                <option value="zh">ç®€ä½“ä¸­æ–‡</option>
                <option value="en">English</option>
            </select>
        </div>
    </div>

    <div id="authView" class="card">
        <h3>ç³»ç»Ÿç™»å½•</h3>
        <input type="email" id="email" placeholder="ç”µå­é‚®ç®±">
        <input type="password" id="password" placeholder="å¯†ç ">
        <select id="role">
            <option value="hotel">é…’åº—æ–¹ (èµ„äº§å‘è¡Œæ–¹)</option>
            <option value="ta">æ—…è¡Œç¤¾ (åˆ†é”€å•†)</option>
            <option value="admin">å¹³å°ç®¡ç†æ–¹ (Platform Admin)</option>
        </select>
        <div class="row">
            <button id="btn_login" onclick="login()">ç™»å½•</button>
            <button onclick="register()" style="background:#edf2f7; color:#4a5568;">æ³¨å†Œ</button>
        </div>
    </div>

    <div id="adminView" class="hidden">
        <div class="card">
            <h3>å¹³å°å…¨æ™¯æ•°æ® (Platform Overview)</h3>
             <button onclick="refreshState()" class="btn-orange" style="width:auto;">åˆ·æ–°æ‰€æœ‰æ•°æ®</button>
        </div>

        <div class="card">
            <h3>å…¨å¹³å°åº“å­˜ (All Inventory)</h3>
            <table class="status-table">
                <thead><tr><th>Token ID</th><th>æˆ¿å‹åç§°</th><th>æ€»å‘è¡Œé‡</th><th>å·²å”®/æµè½¬</th><th>å·²æ ¸é”€</th></tr></thead>
                <tbody id="adminInventoryList"></tbody>
            </table>
        </div>

        <div class="card">
            <h3>å…¨å¹³å°äº¤æ˜“ (All Trades)</h3>
             <table class="status-table">
                <thead><tr><th>å•å·</th><th>ä¹°å®¶</th><th>æ•°é‡</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>
                <tbody id="adminTradeList"></tbody>
            </table>
        </div>

         <div class="card" style="border:1px solid #fc8181; background:#fff5f5;">
            <h3 style="color:#c53030;">âš ï¸ ç³»ç»Ÿé‡ç½® (System Reset)</h3>
            <p style="font-size:12px; color:#c53030;">ç‚¹å‡»æ­¤æŒ‰é’®å°†æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·ã€äº¤æ˜“å’Œåº“å­˜æ•°æ®ã€‚</p>
            <button class="btn-red" onclick="resetSystem()">é‡ç½®æ‰€æœ‰æ•°æ® (Wipe All)</button>
        </div>
    </div>

    <div id="hotelView" class="hidden">
        <div class="card">
            <h3>1. å®šä¹‰èµ„äº§åº“å­˜ (é»‘ç›’å‘è¡Œ)</h3>
            <div class="row">
                <input type="text" id="h_id" placeholder="é…’åº—ä»£ç  (å¦‚: SH-ILTON)" class="col">
                <input type="text" id="h_name" placeholder="æˆ¿å‹åç§° (å¦‚: æ€»ç»Ÿå¥—æˆ¿)" class="col">
            </div>
            <div class="row">
                <input type="number" id="h_supply" placeholder="æ€»å‘è¡Œé‡ (é»‘ç›’æ•°æ®)" class="col">
                <select id="h_dayType" class="col">
                    <option value="WEEKDAY">å¹³æ—¥ (Weekday)</option>
                    <option value="WEEKEND">å‘¨æœ« (Weekend)</option>
                </select>
            </div>
            <div class="row">
                <div class="col">
                    <label style="font-size:12px; color:#666; display:block; margin-bottom:5px;">ä¸é€‚ç”¨æ—¥æœŸ (Start)</label>
                    <input type="date" id="h_blackout_start" style="margin:0;">
                </div>
                <div class="col">
                    <label style="font-size:12px; color:#666; display:block; margin-bottom:5px;">è‡³ (End)</label>
                    <input type="date" id="h_blackout_end" style="margin:0;">
                </div>
                <div class="col">
                    <label style="font-size:12px; color:#666; display:block; margin-bottom:5px;">&nbsp;</label>
                    <input type="number" id="h_cap" placeholder="å…¬å¼€é¢åº¦" style="margin:0;">
                </div>
            </div>
            <br>
            <button id="btn_create_inv" onclick="createInventory()">å‘è¡Œèµ„äº§å‡­è¯</button>
        </div>

        <div class="card">
            <h3>æˆ‘çš„åº“å­˜æ¸…å• (Current Inventory)</h3>
            <table class="status-table">
                <thead><tr><th>Token ID</th><th>æˆ¿å‹åç§°</th><th>æ€»å‘è¡Œé‡</th><th>å·²å”®/æµè½¬</th><th>å·²æ ¸é”€</th></tr></thead>
                <tbody id="hotelInventoryList"></tbody>
            </table>
        </div>

        <div class="card">
            <h3>2. æ‰˜ç®¡åˆ†é”€ (ä¸€çº§å¸‚åœº)</h3>
            <p style="font-size:12px; color:#666;">æµç¨‹: å­˜å…¥æ‰˜ç®¡ -> ç­‰å¾…ä»˜æ¬¾ -> ç¡®è®¤é‡Šæ”¾</p>
            <div class="row">
                <input type="number" id="dist_id" placeholder="å‡­è¯ ID" class="col">
                <input type="text" id="dist_buyer" placeholder="åˆ†é”€å•†é‚®ç®± (TA1)" class="col">
                <input type="number" id="dist_amt" placeholder="æ•°é‡" class="col">
            </div>
            <button id="btn_escrow_hotel" onclick="createEscrow('hotel')" class="btn-green">å‘èµ·æ‰˜ç®¡ (å­˜å…¥èµ„äº§)</button>

            <h4>å¾…ç¡®è®¤æ”¶æ¬¾ (Pending Payments)</h4>
            <button onclick="refreshState()" style="width:auto; padding:2px 8px; font-size:11px; margin-bottom:5px;">åˆ·æ–°åˆ—è¡¨</button>
            <table class="status-table">
                <thead><tr><th>å•å·</th><th>ä¹°å®¶</th><th>æ•°é‡</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>
                <tbody id="hotelTradeList"></tbody>
            </table>
        </div>

        <div class="card">
            <h3>3. å…¥ä½ç®¡ç† (æ ¸é”€ç¡®è®¤)</h3>
            <table class="status-table">
                <thead><tr><th>å•å·</th><th>è¡Œç¨‹ (å…¥ä½ - é€€æˆ¿)</th><th>æ•°é‡</th><th>ä½å®¢</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>
                <tbody id="hotelBookingList"></tbody>
            </table>
        </div>

        <div class="card" style="border:1px solid #fc8181; background:#fff5f5;">
            <h3 style="color:#c53030;">âš ï¸ æ¼”ç¤ºç³»ç»Ÿé‡ç½® (Admin Zone)</h3>
            <p style="font-size:12px; color:#c53030;">ç‚¹å‡»æ­¤æŒ‰é’®å°†æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·ã€äº¤æ˜“å’Œåº“å­˜æ•°æ®ã€‚è¯·ä»…åœ¨æ¼”ç¤ºç»“æŸåä½¿ç”¨ã€‚</p>
            <button class="btn-red" onclick="resetSystem()">é‡ç½®æ‰€æœ‰æ•°æ® (Wipe All)</button>
        </div>
    </div>

    <div id="taView" class="hidden">
        <div class="card">
            <h3>æˆ‘çš„èµ„äº§æ“ä½œ</h3>
            <div class="row">
                <button onclick="refreshState()" class="btn-orange">åˆ·æ–°æ•°æ®</button>
            </div>
        </div>

        <div class="card">
            <h3>æˆ‘çš„èµ„äº§æ¸…å• (My Inventory)</h3>
            <table class="status-table">
                <thead><tr><th>Token ID</th><th>æˆ¿å‹åç§°</th><th>æŒæœ‰æ•°é‡</th><th>å·²æ ¸é”€ (å…¥ä½)</th></tr></thead>
                <tbody id="taInventoryList"></tbody>
            </table>
        </div>

        <div class="card">
            <h3>äºŒçº§åˆ†é”€ (è½¬å”®)</h3>
            <div class="row">
                <input type="number" id="ta_sell_id" placeholder="å‡­è¯ ID" class="col">
                <input type="text" id="ta_sell_buyer" placeholder="ä¹°å®¶é‚®ç®± (TA2)" class="col">
                <input type="number" id="ta_sell_amt" placeholder="æ•°é‡" class="col">
            </div>
            <button id="btn_hw_trigger" onclick="triggerHwCheck()">å‘èµ·èµ„äº§è½¬è®© (éœ€ç¡¬ä»¶ç­¾å)</button>

            <h4>æˆ‘çš„é”€å”®è®¢å• (å¾…æ”¶æ¬¾)</h4>
            <table class="status-table">
                <thead><tr><th>å•å·</th><th>ä¹°å®¶</th><th>æ•°é‡</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>
                <tbody id="taTradeList"></tbody>
            </table>
        </div>

        <div class="card">
            <h3>æˆ¿æ™šæ ¸é”€ (é¢„è®¢)</h3>
            <div class="row">
                <input type="number" id="ta_book_id" placeholder="å‡­è¯ ID" class="col">
                <input type="text" id="ta_book_guest" placeholder="ä½å®¢å§“å" class="col">
            </div>
            <div class="row">
                <div class="col">
                    <label style="font-size:12px; color:#666; display:block; margin-bottom:5px;">å…¥ä½ (Check-In)</label>
                    <input type="date" id="ta_book_checkin" style="margin:0;" onchange="calculateCost()">
                </div>
                <div class="col">
                    <label style="font-size:12px; color:#666; display:block; margin-bottom:5px;">é€€æˆ¿ (Check-Out)</label>
                    <input type="date" id="ta_book_checkout" style="margin:0;" onchange="calculateCost()">
                </div>
                <div class="col">
                    <label style="font-size:12px; color:#666; display:block; margin-bottom:5px;">æˆ¿é—´æ•°</label>
                    <input type="number" id="ta_book_rooms" value="1" min="1" style="margin:0;" onchange="calculateCost()">
                </div>
            </div>
            <div style="margin:10px 0; font-weight:bold; color:#2b6cb0;" id="calcResult">é¢„è®¡æ¶ˆè€—: 0 Token</div>
            
            <button id="btn_book" onclick="requestBooking()" class="btn-green">æäº¤é¢„è®¢ (å­˜å…¥æ ¸é”€æ‰˜ç®¡)</button>

            <h4>æˆ‘çš„é¢„è®¢è®°å½•</h4>
            <table class="status-table">
                <thead><tr><th>å•å·</th><th>è¡Œç¨‹ (å…¥ä½ - é€€æˆ¿)</th><th>æ•°é‡</th><th>ä½å®¢</th><th>çŠ¶æ€</th></tr></thead>
                <tbody id="taBookingList"></tbody>
            </table>
        </div>
    </div>

    <div id="logs" class="log-box hidden"><div>> ç³»ç»Ÿå°±ç»ª...</div></div>

    <div id="hwModal" class="modal-overlay hidden">
        <div class="modal-box">
            <div style="font-size:40px;">ğŸ”</div>
            <h3>å®‰å…¨é£æ§æ£€æŸ¥</h3>
            <p>å¤§é¢èµ„äº§è°ƒæ‹¨éœ€è¦ç¡¬ä»¶å¯†é’¥ (USB Key) ç­¾å</p>
            <div id="hwStatus" style="font-weight:bold; color:#e53e3e; margin:10px 0;">è¯·æ’å…¥ç¡¬ä»¶å¯†é’¥...</div>
            <div class="progress-bar"><div id="hwProgress" class="progress-fill"></div></div>
            <button id="hwBtn" onclick="simulateHwSign()">æ¨¡æ‹Ÿæ’å…¥å¯†é’¥</button>
            <button onclick="document.getElementById('hwModal').classList.add('hidden')" style="background:#ccc; margin-top:10px;">å–æ¶ˆ</button>
        </div>
    </div>

</div>
<script src="app.js"></script>
</body>
</html>
